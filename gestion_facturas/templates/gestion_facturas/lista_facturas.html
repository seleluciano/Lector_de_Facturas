{% extends 'gestion_facturas/base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row mb-4">
        <div class="col">
            <h2>Lista de Facturas</h2>
        </div>
        <div class="col text-end">
            <a href="{% url 'gestion_facturas:cargar_factura' %}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nueva Factura
            </a>
        </div>
    </div>

    {% if facturas %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Número</th>
                    <th>Fecha</th>
                    <th>CUIT/CUIL/DNI</th>
                    <th>Razón Social Cliente</th>
                    <th>Cond. IVA</th>
                    <th>Cond. Venta</th>
                    <th>Subtotal</th>
                    <th>IVA</th>
                    <th>IIBB</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for factura in facturas %}
                <tr>
                    <td>{{ factura.get_tipo_factura_display }}</td>
                    <td>{{ factura.punto_venta }}-{{ factura.numero }}</td>
                    <td>{{ factura.fecha_emision|date:"d/m/Y" }}</td>
                    <td>{{ factura.cuit }}</td>
                    <td>{{ factura.razon_social_cliente|default:'' }}</td>
                    <td>{{ factura.get_condicion_iva_display }}</td>
                    <td>{{ factura.get_condicion_venta_display }}</td>
                    <td>${{ factura.subtotal }}</td>
                    <td>${{ factura.iva }}</td>
                    <td>${{ factura.percepcion_iibb }}</td>
                    <td>${{ factura.monto_total }}</td>
                    <td>
                        <div class="btn-group">
                            {% if factura.imagen %}
                            <a href="{{ factura.imagen.url }}" class="btn btn-sm btn-info" target="_blank" title="Ver imagen">
                                <i class="fas fa-eye"></i>
                            </a>
                            {% endif %}
                            <button type="button" 
                                    class="btn btn-sm btn-primary" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#productosModal{{ factura.id }}"
                                    title="Ver productos">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>

                        <!-- Modal para productos -->
                        <div class="modal fade" id="productosModal{{ factura.id }}" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Productos - Factura {{ factura.punto_venta }}-{{ factura.numero }}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Descripción</th>
                                                        <th>Cantidad</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for producto in factura.productos.all %}
                                                    <tr>
                                                        <td>{{ producto.descripcion }}</td>
                                                        <td>{{ producto.cantidad }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
        No hay facturas registradas. <a href="{% url 'gestion_facturas:cargar_factura' %}">Cargar una nueva factura</a>
    </div>
    {% endif %}
</div>
{% endblock %} 